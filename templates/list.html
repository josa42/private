<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Kontakte</title>
	<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
	<style>
		* { box-sizing: border-box; }
		body { 
			font-family: Arial, sans-serif; 
			margin: 0;
			padding: 20px;
			background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
			min-height: 100vh;
			display: flex;
			align-items: flex-start;
			justify-content: center;
			padding-top: 40px;
		}
		.container {
			background: white;
			border-radius: 12px;
			padding: 0;
			max-width: 680px;
			width: 100%;
			box-shadow: 0 10px 40px rgba(0,0,0,0.2);
		}
		.container-inner {
			padding: 30px;
		}
		.breadcrumb { 
			margin-bottom: 0; 
			color: #666;
			font-size: 14px;
			position: sticky;
			top: 0;
			background: white;
			z-index: 11;
			padding: 15px 30px;
			margin: 0;
			border-radius: 12px 12px 0 0;
			display: flex;
			justify-content: space-between;
			align-items: center;
		}
		.breadcrumb-nav { display: flex; align-items: center; }
		.logout-btn {
			background-color: transparent;
			color: #999;
			padding: 6px;
			border-radius: 4px;
			text-decoration: none;
			font-size: 13px;
			display: flex;
			align-items: center;
			gap: 4px;
			transition: color 0.2s, background-color 0.2s;
		}
		.logout-btn:hover { 
			background-color: #f5f5f5;
			color: #666;
		}
		.breadcrumb a { color: #667eea; text-decoration: none; }
		.breadcrumb a:hover { text-decoration: underline; }
		.breadcrumb span { margin: 0 5px; }
		h1 { color: #333; margin: 0 0 20px 0; }
		.header { 
			display: flex; 
			justify-content: space-between; 
			align-items: center; 
			margin-bottom: 20px; 
			flex-wrap: wrap; 
			gap: 10px;
			position: sticky;
			top: 44px;
			background: white;
			z-index: 10;
			padding: 15px 30px;
			margin: 0 -30px 20px -30px;
			border-bottom: 1px solid #e0e0e0;
		}
		.header h1 { margin: 0; }
		.header > div { display: flex; gap: 10px; flex-wrap: wrap; }
		table { 
			border-collapse: collapse; 
			width: 100%; 
			overflow-x: auto; 
			display: block; 
		}
		thead, tbody { display: table; width: 100%; table-layout: fixed; }
		th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
		th { background-color: #667eea; color: white; }
		tr:hover { background-color: #f5f5f5; }
		tbody tr { cursor: pointer; }
		a { color: #667eea; text-decoration: none; }
		a:hover { text-decoration: underline; }
		.delete-link { color: #f44336; }
		.action-icon { vertical-align: middle; font-size: 18px; }
		.actions { white-space: nowrap; text-align: right; }
		.actions a { display: inline-flex; align-items: center; margin-left: 12px; }
		.btn { 
			background-color: #667eea; 
			color: white; 
			padding: 10px 20px; 
			border: none; 
			border-radius: 4px; 
			cursor: pointer; 
			text-decoration: none;
			display: inline-flex; 
			align-items: center; 
			white-space: nowrap;
			font-size: 14px;
		}
		.btn:hover { background-color: #5568d3; }
		
		@media (max-width: 768px) {
			body { padding: 0; padding-top: 0; background: white; }
			.container { padding: 0; max-width: 100%; border-radius: 0; box-shadow: none; }
			.container-inner { padding: 15px; }
			.breadcrumb {
				padding: 10px 15px;
				border-radius: 0;
				margin-bottom: 0;
			}
			.header { 
				margin: 0 -15px 20px -15px; 
				padding: 10px 15px;
				top: 34px;
			}
			.breadcrumb { font-size: 12px; overflow-x: auto; white-space: nowrap; }
			h1 { font-size: 1.5em; }
			.header { flex-direction: column; align-items: stretch; }
			.header > div { justify-content: stretch; }
			.btn { padding: 8px 12px; font-size: 13px; justify-content: center; }
			.btn .material-icons { font-size: 16px; }
			th, td { padding: 6px 4px; font-size: 13px; }
			.actions a { margin-left: 8px; }
			.action-icon { font-size: 20px; }
		}
	</style>
</head>
<body>
	<div class="container">
		<nav class="breadcrumb">
			<div class="breadcrumb-nav">
				<a href="/">Home</a>
				<span>›</span>
				<span>Kontakte</span>
			</div>
			<a href="/logout" class="logout-btn" title="Abmelden">
				<span class="material-icons" style="font-size: 20px;">logout</span>
			</a>
		</nav>
		<div class="container-inner">
			<div class="header">
			<h1>Kontakte</h1>
			<div>
				<form action="/contacts/normalize" method="POST" style="display: inline;" onsubmit="return confirm('Alle Telefonnummern normalisieren (0... → +49..., Leerzeichen einfügen)?')">
					<button type="submit" class="btn" style="background-color: #FF9800; margin-right: 10px;">
						<span class="material-icons" style="vertical-align: middle; font-size: 18px; margin-right: 4px;">auto_fix_high</span>
						Normalisieren
					</button>
				</form>
				{{if .HasCardDAVConfig}}
				<form action="/contacts/sync-carddav" method="POST" style="display: inline;">
					<button type="submit" class="btn" style="background-color: #9C27B0; margin-right: 10px;">
						<span class="material-icons" style="vertical-align: middle; font-size: 18px; margin-right: 4px;">sync</span>
						CardDAV Sync
					</button>
				</form>
				{{end}}
				<a href="/contacts/import" class="btn" style="margin-right: 10px; background-color: #2196F3;">
					<span class="material-icons" style="vertical-align: middle; font-size: 18px; margin-right: 4px;">file_upload</span>
					vCard
				</a>
				<a href="/contacts/import-carddav" class="btn" style="margin-right: 10px; background-color: #4CAF50;">
					<span class="material-icons" style="vertical-align: middle; font-size: 18px; margin-right: 4px;">cloud_download</span>
					CardDAV Manual
				</a>
				<a href="/contacts/new" class="btn" style="margin-right: 10px;">Neuer Kontakt</a>
			</div>
		</div>
		<table>
			<tr>
				<th>Name</th>
				<th>Telefonnummer</th>
				<th style="width: 90px;">Aktionen</th>
			</tr>
			{{range $i, $c := .Contacts}}
			<tr onclick="window.location='/contacts/edit?id={{$i}}'">
				<td>
					{{if $c.CompanyName}}
						<strong>{{$c.CompanyName}}</strong>
					{{else if $c.FirstName}}
						{{$c.FirstName}} {{$c.LastName}}
					{{else}}
						-
					{{end}}
				</td>
				<td>{{$c.Phone.PhoneNumber}}</td>
				<td class="actions">
					<a href="/contacts/edit?id={{$i}}" onclick="event.stopPropagation()" title="Bearbeiten">
						<span class="material-icons action-icon">edit</span>
					</a>
					<a href="#" class="delete-link" onclick="event.stopPropagation(); if(confirm('Kontakt wirklich löschen?')) { var form = document.createElement('form'); form.method = 'POST'; form.action = '/contacts/edit'; var idInput = document.createElement('input'); idInput.type = 'hidden'; idInput.name = 'id'; idInput.value = '{{$i}}'; var actionInput = document.createElement('input'); actionInput.type = 'hidden'; actionInput.name = 'action'; actionInput.value = 'delete'; form.appendChild(idInput); form.appendChild(actionInput); document.body.appendChild(form); form.submit(); } return false;" title="Löschen">
						<span class="material-icons action-icon">delete</span>
					</a>
				</td>
			</tr>
			{{end}}
		</table>
		</div>
	</div>
</body>
</html>
