<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>{{if .IsNew}}Neuer Kontakt{{else}}Kontakt bearbeiten{{end}}</title>
	<style>
		body { font-family: Arial, sans-serif; margin: 20px; max-width: 600px; }
		.breadcrumb { margin-bottom: 20px; color: #666; }
		.breadcrumb a { color: #4CAF50; text-decoration: none; }
		.breadcrumb a:hover { text-decoration: underline; }
		.breadcrumb span { margin: 0 5px; }
		label { display: block; margin-top: 10px; font-weight: bold; }
		input { width: 100%; padding: 8px; margin-top: 5px; border: 1px solid #ddd; 
		        border-radius: 4px; box-sizing: border-box; }
		select { padding: 8px; margin-top: 5px; border: 1px solid #ddd; 
		         border-radius: 4px; box-sizing: border-box; }
		.contact-type-select { width: 100%; margin-bottom: 20px; }
		.form-section { display: none; }
		.form-section.active { display: block; }
		.phone-row { display: flex; gap: 10px; margin-top: 10px; align-items: flex-start; }
		.phone-row > div:first-child { flex: 2; }
		.phone-row > div:last-child { flex: 1; }
		.btn { background-color: #4CAF50; color: white; padding: 10px 20px; 
		       border: none; border-radius: 4px; cursor: pointer; }
		.btn:hover { background-color: #45a049; }
		.cancel { background-color: #999; margin-right: 10px; text-decoration: none;
		          display: inline-block; padding: 10px 20px; color: white; border-radius: 4px; }
		.cancel:hover { background-color: #888; }
		.delete { background-color: #f44336; margin-right: auto; text-decoration: none;
		          display: inline-block; padding: 10px 20px; color: white; border-radius: 4px; border: none; cursor: pointer; }
		.delete:hover { background-color: #da190b; }
		.form-buttons { margin-top: 20px; display: flex; justify-content: flex-end; align-items: center; }
	</style>
</head>
<body>
	<nav class="breadcrumb">
		<a href="/">Home</a>
		<span>›</span>
		<a href="/contacts">Kontakte</a>
		<span>›</span>
		<span>{{if .IsNew}}Neuer Kontakt{{else}}{{if .Contact.CompanyName}}{{.Contact.CompanyName}}{{else if .Contact.FirstName}}{{.Contact.FirstName}} {{.Contact.LastName}}{{else}}{{.Contact.Phone.PhoneNumber}}{{end}}{{end}}</span>
	</nav>
	<h1>{{if .IsNew}}Neuer Kontakt{{else}}Kontakt bearbeiten{{end}}</h1>
	<form method="POST">
		<input type="hidden" name="id" value="{{.ID}}">
		
		<label>Kontakttyp:</label>
		<select id="contactType" class="contact-type-select" onchange="toggleContactType()">
			<option value="person" {{if not .Contact.CompanyName}}selected{{end}}>Person</option>
			<option value="company" {{if .Contact.CompanyName}}selected{{end}}>Firma</option>
		</select>
		
		<div id="personFields" class="form-section">
			<label>Vorname:</label>
			<input type="text" id="firstName" name="firstName" value="{{.Contact.FirstName}}">
			
			<label>Nachname:</label>
			<input type="text" id="lastName" name="lastName" value="{{.Contact.LastName}}">
		</div>
		
		<div id="companyFields" class="form-section">
			<label>Firmenname:</label>
			<input type="text" id="companyName" name="companyName" value="{{.Contact.CompanyName}}">
		</div>
		
		<div class="phone-row">
			<div>
				<label>Telefonnummer:</label>
				<input type="tel" name="phoneNumber" value="{{.Contact.Phone.PhoneNumber}}" 
				       pattern="^[\d\s+/()-]+$" 
				       title="Nur Ziffern, Leerzeichen und die Zeichen + - / ( ) sind erlaubt"
				       required
				       oninvalid="this.setCustomValidity('Bitte geben Sie eine gültige Telefonnummer ein (nur Ziffern und + - / ( ) Leerzeichen)')"
				       oninput="this.setCustomValidity('')">
			</div>
			<div>
				<label>Typ:</label>
				<select name="phoneType" style="width: 100%;">
					<option value="cell" {{if eq .Contact.Phone.Type "cell"}}selected{{end}}>Mobil</option>
					<option value="work" {{if eq .Contact.Phone.Type "work"}}selected{{end}}>Firma</option>
					<option value="home" {{if eq .Contact.Phone.Type "home"}}selected{{end}}>Privat</option>
				</select>
			</div>
		</div>
		
		<div class="form-buttons">
			{{if not .IsNew}}
			<button type="submit" name="action" value="delete" class="delete" onclick="return confirm('Kontakt wirklich löschen?')">Löschen</button>
			{{end}}
			<a href="/contacts" class="cancel">Abbrechen</a>
			<button type="submit" class="btn">Speichern</button>
		</div>
	</form>

	<script>
		function toggleContactType() {
			const contactType = document.getElementById('contactType').value;
			const personFields = document.getElementById('personFields');
			const companyFields = document.getElementById('companyFields');
			const firstName = document.getElementById('firstName');
			const lastName = document.getElementById('lastName');
			const companyName = document.getElementById('companyName');
			
			if (contactType === 'person') {
				personFields.classList.add('active');
				companyFields.classList.remove('active');
				companyName.value = '';
				companyName.removeAttribute('required');
				// At least one of firstName or lastName should be filled
				// We'll use a custom validation approach
				firstName.removeAttribute('required');
				lastName.removeAttribute('required');
			} else {
				personFields.classList.remove('active');
				companyFields.classList.add('active');
				firstName.value = '';
				lastName.value = '';
				firstName.removeAttribute('required');
				lastName.removeAttribute('required');
				companyName.setAttribute('required', 'required');
			}
		}
		
		// Initialize on page load
		toggleContactType();
		
		// Custom validation for person fields (at least one name required)
		document.querySelector('form').addEventListener('submit', function(e) {
			const contactType = document.getElementById('contactType').value;
			
			if (contactType === 'person') {
				const firstName = document.getElementById('firstName').value.trim();
				const lastName = document.getElementById('lastName').value.trim();
				
				if (!firstName && !lastName) {
					e.preventDefault();
					document.getElementById('firstName').setCustomValidity('Bitte geben Sie mindestens Vor- oder Nachnamen ein.');
					document.getElementById('firstName').reportValidity();
					return false;
				} else {
					document.getElementById('firstName').setCustomValidity('');
				}
			}
		});
		
		// Clear custom validity on input
		document.getElementById('firstName').addEventListener('input', function() {
			this.setCustomValidity('');
		});
	</script>
</body>
</html>
